language en_US.UTF-8

colorscheme nord

" Syntax highlighting
syntax on

" Keep cursor vertically centered
set scrolloff=999

" Update gitgutter in real time-ish
set updatetime=100

" Line numbers
set number
set relativenumber

" Ignore search case if only lower case characters, otherwise be case sensitive
set ignorecase
set smartcase

" Make `vnew` & `new` open windows to the right & bottom
set splitright
set splitbelow

" fzf.vim is broken with fish and for some reason uses this rather than &shell
" to determine the shell to run fzf in
let $SHELL = '/bin/bash'

" Mappings
let mapleader = ","

" Clear search highlight on escape
nnoremap <silent> <esc> :noh<return><esc>

" Moving around windows
nnoremap <silent> <c-h> <c-w>h
nnoremap <silent> <c-j> <c-w>j
nnoremap <silent> <c-k> <c-w>k
nnoremap <silent> <c-l> <c-w>l

" fzf
nnoremap <leader>f :Files<CR>

" NERDTree
nnoremap <leader>e :NERDTreeFind<CR>

" exit if nerdtree is the only window left (from https://github.com/preservim/nerdtree)
autocmd BufEnter * if tabpagenr('$') == 1 && winnr('$') == 1 && exists('b:NERDTree') && b:NERDTree.isTabTree() |
    \ quit | endif

" coc.nvim
nmap <silent> <Leader>b <Plug>(coc-references)
nmap <silent> <Leader>d <Plug>(coc-definition)
nmap <silent> <Leader>r <Plug>(coc-rename)
nmap <silent> <Leader>t <Plug>(coc-type-definition)
nmap <silent> <Leader>x :CocFix<CR>
nnoremap <silent> K :call <SID>show_documentation()<CR>

function! s:show_documentation()
	if (index(['vim','help'], &filetype) >= 0)
		execute 'h '.expand('<cword>')
	elseif (coc#rpc#ready())
		call CocActionAsync('doHover')
	else
		execute '!' . &keywordprg . " " . expand('<cword>')
	endif
endfunction

function! s:trailing_whitespace()
  hi ExtraWhitespace cterm=underline,bold gui=underline,bold ctermfg=blue
  match ExtraWhitespace /\s\+$/
endfunction

au BufWinEnter * :call s:trailing_whitespace()

" Prevent pear tree (bracket complete plugin) from hiding paired character
" when pressing <CR> (this was done in the plugin originally to keep dot
" repeatability working, but idgaf)
let g:pear_tree_repeatable_expand = 0
